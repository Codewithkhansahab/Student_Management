<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
    }

    .container-custom {
      max-width: 1100px;
      margin: auto;
      padding-top: 30px;
    }

    .card-custom {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      padding: 20px;
      background: white;
    }

    .form-section {
      background: #f1f1f1;
      padding: 15px;
      border-radius: 8px;
    }

    h2 {
      text-align: center;
      margin-bottom: 25px;
      color: #0d6efd;
    }

    .btn i {
      margin-right: 4px;
    }
  
  </style>
</head>
<body>
    
  <div class="container container-custom">
    <div class="card-custom">
      <h2>üìã Student List</h2>

      <form action="/givelist" method="get" class="d-flex flex-wrap gap-2 mb-4 justify-content-between align-items-center form-section">
        <input 
          type="text" 
          name="search" 
          class="form-control form-control-sm" 
          placeholder="üîç Search by name or email"
          value="<%= search || '' %>" 
          style="max-width: 220px;"
        >
        <button class="btn btn-success btn-sm" type="submit"><i class="bi bi-search"></i> Search</button>
        <a href="/sort" class="btn btn-outline-primary btn-sm"><i class="bi bi-filter"></i> Sort Record</a>
        <div>
          <label for="sort" class="form-label mb-1">Sort by</label>
          <select class="form-select form-select-sm" id="sort" name="sort">
            <option value="">-- Select --</option>
            <option value="name">Name</option>
            <option value="email">Email</option>
            <option value="id">ID</option>
            <option value="age">Age</option>
          </select>
        </div>
      </form>

      <table class="table table-bordered table-hover text-center">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Course</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% result.forEach(student => { %>
            <tr>
              <td><%= student.name %></td>
              <td><%= student.email %></td>
              <td><%= student.course %></td>
              <td><%= student.age %></td>
              <td><%= student.gender %></td>
              <td><%= student.status %></td>
              <td>
                <button class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal"onclick="setDeleteId(<%= student.id %>)">üóë Delete</button>

                <form action="/edit" method="get" class="d-inline">
                  <input type="hidden" name="id" value="<%= student.id %>">
                  <button type="submit" class="btn btn-sm btn-primary">‚úèÔ∏è Edit</button>
                </form>

                <form action="/viewDetails/<%= student.id %>" method="get" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-secondary">üëÅÔ∏è View</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <a href="/back" class="btn btn-secondary mt-3"><i class="bi bi-arrow-left-circle"></i> Back to Admin Panel</a>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="deleteForm" method="get">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="deleteModalLabel">‚ö†Ô∏è Confirm Deletion</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this student?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger">Yes, Delete</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Bootstrap JS and Icons -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  
  <script>
    if (window.location.search.includes("toast=updated") || window.location.search.includes("toast=deleted")) {
      const newUrl = window.location.origin + window.location.pathname;
      window.history.replaceState({}, document.title, newUrl);
    }

    function setDeleteId(id) {
      const form = document.getElementById('deleteForm');
      form.action = '/remove/' + id;
    }

    document.getElementById('sort').addEventListener('change', function () {
      const select = this.value;
      if (select) {
        if (select === 'name') window.location.href = '/sortName';
        else if (select === 'email') window.location.href = '/emailSort';
        else if (select === 'id') window.location.href = '/idSort';
        else if (select === 'age') window.location.href = '/ageSort';
      }
    });
  </script>
</body>
</html>
